version: "{build}"

init:
  - git config --global core.autocrlf input

environment:
  matrix:
    - QT6: C:\Qt\6.0.1\mingw81_64
      MINGW: C:\Qt\Tools\mingw810_64
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
    - QT6: $HOME/Qt/6.0.0
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu2004
    # 6.0.2 not yet available as of 05 March 2021
    # - QT6: C:\Qt\6.0.2\mingw81_64
    #   MINGW: C:\Qt\Tools\mingw810_64
    #   APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019

matrix:
  fast_finish: false

before_build:
  - ps: echo $env:PATH
  - ps: set PATH=$env:MINGW\bin;$env:QT6\bin;$env:PATH

build_script:
  - mkdir build
  - cd build
  # build library and tests
  - cmake --version
  # IGNORE_PATH is a workaround for CMake not wanting sh.exe on PATH for MinGW
  - ps: cmake -G "MinGW Makefiles" -DCMAKE_IGNORE_PATH="C:/Program Files/Git/usr/bin" -DCMAKE_BUILD_TYPE=Release --build ..
  - ps: dir /s
  - sh: cmake -G "Unix Makefiles" -DCMAKE_BUILD_TYPE=Release --build ..
  - sh: ls -lah *
  - cd tests
  - ps: qtcsv_tests.exe
  - sh: ./qtcsv_tests
  # - mingw32-make
  # - dir /s
  # - cd .\tests
  # run tests
  # - dir /s
  # - qtcsv_tests.exe
