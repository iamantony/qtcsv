version: "{build}"

init:
- git config --global core.autocrlf input

environment:
  matrix:
  - QT5: C:\Qt\5.6.3\mingw49_32
    MINGW: C:\Qt\Tools\mingw530_32
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
  - QT5: C:\Qt\5.9\mingw53_32
    MINGW: C:\Qt\Tools\mingw530_32
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
  - QT5: C:\Qt\5.12\mingw73_32
    MINGW: C:\Qt\Tools\mingw730_32
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
  - QT5: C:\Qt\5.15\mingw81_32
    MINGW: C:\Qt\Tools\mingw81_32
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
    use_cmake: "false"

matrix:
  fast_finish: true

before_build:
- set PATH=%MINGW%\bin;%QT5%\bin;%PATH%

build_script:
- mkdir .\build
- cd .\build

# build library and tests
- qmake -v
- qmake ..\qtcsv.pro CONFIG+=release DESTDIR=%cd%
- mingw32-make
- dir /s
- mkdir .\tests
- cd .\tests
- copy ..\*qtcsv.dll .\
- qmake ..\..\tests\tests.pro CONFIG+=release DESTDIR=%cd%\tests
- mingw32-make

# download test file
#- wget -O worldcitiespop.txt.gz https://raw.github.com/apache/commons-csv/master/src/test/resources/perf/worldcitiespop.txt.gz
#- 7z e worldcitiespop.txt.gz
#- move worldcitiespop.txt data\

# run tests
- dir /s
- qtcsv_tests.exe
